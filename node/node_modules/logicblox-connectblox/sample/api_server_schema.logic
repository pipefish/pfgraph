// Users
user(u), user_name(u:name) -> string(name).
user_key[u] = key          -> user(u), string(key).
user_is_admin(u)           -> user(u).

// Workspaces
workspace(ws), workspace_name(ws:name) -> string(name).

// Workspace permissions
workspace_permission_addblock(ws, u) -> workspace(ws), user(u).
workspace_permission_exec(ws, u)     -> workspace(ws), user(u).
workspace_permission_query(ws, u)    -> workspace(ws), user(u).
workspace_permission_list(ws, u)     -> workspace(ws), user(u).

// Permission check rules
user_can_create(u)       -> user(u).
user_can_delete(u)       -> user(u).
user_can_register(u)     -> user(u).
user_can_addblock(u, ws) -> user(u), workspace(ws).
user_can_exec(u, ws)     -> user(u), workspace(ws).
user_can_query(u, ws)    -> user(u), workspace(ws).
user_can_list(u, ws)     -> user(u), workspace(ws).

user_can_create(u) <- 
  user_is_admin(u).

user_can_delete(u) <- 
  user_is_admin(u).

user_can_register(u) <- 
  user_is_admin(u).

user_can_addblock(u, ws) <- 
  user_is_admin(u), workspace(ws)
  ; workspace_permission_addblock(ws, u).

user_can_exec(u, ws) <- 
  user_is_admin(u), workspace(ws)
  ; workspace_permission_exec(ws, u).

user_can_query(u, ws) <- 
  user_is_admin(u), workspace(ws)
  ; workspace_permission_query(ws, u).

user_can_list(u, ws) <- 
  user_is_admin(u), workspace(ws)
  ; workspace_permission_list(ws, u).